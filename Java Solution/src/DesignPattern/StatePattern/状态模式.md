# 状态模式

## Intent
允许对象在内部对象改变时，改变他的行为，对象看起来好像修改了它所属的类。



## Class Diagram

![img](https://github.com/CyC2018/CS-Notes/raw/master/notes/pics/79df886f-fdc3-4020-a07f-c991bb58e0d8.png)

## 何时使用

代码中包含大量的与对象有关的条件语句

## 优点

1. 封装了转换规则
2. 枚举可能的状态，在枚举状态之前需要确定状态种类
3. 将所有与某个状态有关的行为都放在一个类中，并且可以方便的增加新的状态，只需要改变对象状态即可改变对象的行为
4. 允许状态转换逻辑和状态对象合为一体，而不是某一个巨大的条件语句块
5. 可以让多个环境对象共享一个状态对象，从而减少系统中对象的个数

## 缺点

1. 状态模式的使用必然会增加系统类和对象的个数
2. 状态模式的结构和实现都较为复杂，如果使用不当讲导致程序结构和代码的混乱
3. 状态模式对“开闭原则”的支持并不太好，对于可以切换状态的状态模式，增加新的状态类需要修改那些负责状态转换的源代码，否则无法切换到新增状态，而且修改某个状态类的行为也需要修改对应类的源代码

## 注意事项

在行为受状态约束的时候使用状态模式，而且状态不要超过5个。

## 使用场景

1. 行为随状态改变而改变的场景
2. 条件、分支语句的代替者

## 关键代码

通常命令模式的接口中只有一个方法。而状态模式的接口中有一个或者多个方法。而且，状态模式的实现类的方法，一般返回值，或者是改变实例变量的值。也就是说，状态模式一般和对象的状态有关。实现类的方法有不同的功能，覆盖接口中的方法。状态模式和命令模式一样，也可以用于消除 if...else 等条件选择语句。

## 1. 糖果贩卖机

糖果销售机有多种状态，每种状态下销售机有不同的行为，状态可以发生转移，使得销售机的行为也发生改变。

比如，现在发生了投币insertQuarter这个动作，这个动作到底会怎么执行，要看当前是处于什么状态，比如是否是重复投币，是否已经在出货了等等。

那么每个动作执行的时候都要判断一下当前是什么状态，就会有特别多的分支语句。状态模式利用多态的特点，每次有一个动作来时，使用State（接口）的引用来执行相应动作，这个动作到底是执行哪个函数是动态决定的，也就是有当前state指向哪个对象来决定的。

比如已经投币，现在处于HasQuarter状态，在这个状态下投币就是重复投币。那么state调用insertQuarter方法实际执行的是HasQuarter的insetQuarter，就少了判断。

![img](https://github.com/CyC2018/CS-Notes/raw/master/notes/pics/396be981-3f2c-4fd9-8101-dbf9c841504b.jpg)

## 2. StateContext



![状态模式的 UML 图](https://www.runoob.com/wp-content/uploads/2014/08/state_pattern_uml_diagram.png)